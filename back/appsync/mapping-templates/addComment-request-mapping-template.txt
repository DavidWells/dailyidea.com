{
    "version" : "2017-02-28",
    "operation" : "UpdateItem",
    "key" : {
        "ideaId" : { "S" : "${context.arguments.ideaId}" },
        "userId" : { "S" : "${context.arguments.userId}" }
    },
    "update" : {
        "expression" : "SET comments = list_append(if_not_exists(comments, :empty_list), :comment)",
        "expressionValues": {
        	":comment" : {"L":  [{"M" : {
        	      "body": {"S": "${context.arguments.body}"},
        	      "userId": {"S": "${context.identity.username}"},
        	      "createdDate" : $util.dynamodb.toDynamoDBJson($util.time.nowISO8601()),
        	      "commentId" : $util.dynamodb.toDynamoDBJson($util.autoId())
        	   }}]
        	},
        	":empty_list": {"L": []}
        }
    }
}
